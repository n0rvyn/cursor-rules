---
description: "Swift 6.2 + iOS 18-26 ç¼–ç è§„èŒƒ - è¯¦ç»†å‚è€ƒ"
scopes: [chat, edit]
tags: [swift, ios, coding-standards, swiftui, detailed-reference]
priority: 202
globs: []
alwaysApply: false
---

# Swift 6.2 + iOS 18-26 ç¼–ç è§„èŒƒï¼ˆè¯¦ç»†å‚è€ƒï¼‰

> **æ³¨æ„**ï¼šæœ¬æ–‡ä»¶ä¸ºè¯¦ç»†å‚è€ƒï¼Œä¸ä¼šè‡ªåŠ¨åŠ è½½ã€‚  
> **æ ¸å¿ƒå‘½åè§„èŒƒ**ï¼šè§ `000-critical-rules.mdc` çš„"å¿…é¡»éµå®ˆ"éƒ¨åˆ†

---

> **å®Œæ•´è§„èŒƒè§**: `docs/08-guidelines/coding-standards.md`ï¼ˆ2000+ è¡Œï¼‰  
> æœ¬æ–‡æ¡£ä»…åŒ…å«æ ¸å¿ƒè¦ç‚¹å’Œå¿«é€Ÿå‚è€ƒ

---

## ğŸ¯ ç‰ˆæœ¬æ”¯æŒç­–ç•¥

| ç‰ˆæœ¬ | æ”¯æŒçº§åˆ« | è¯´æ˜ |
|------|---------|------|
| **iOS 26** | ğŸŸ¢ ä¸»åŠ›æ”¯æŒ | ä½¿ç”¨æœ€æ–°ç‰¹æ€§ï¼ˆLiquid Glassã€Apple Intelligenceï¼‰ |
| **iOS 18** | ğŸŸ¡ å…¼å®¹æ”¯æŒ | é™çº§é€‚é…ï¼Œè¦†ç›–æ›´å¤šç”¨æˆ· |
| **iOS 17** | ğŸ”´ ä¸æ”¯æŒ | WorkoutKit ä¸ç¨³å®šï¼ŒObservable å®æœ‰é—®é¢˜ |

**æŠ€æœ¯æ ˆç‰ˆæœ¬**ï¼š
- Swift: 6.2
- iOS: 18.0+ (æ¨è 26.0)
- Xcode: 16.0+
- SwiftUI: iOS 18+
- SwiftData: iOS 18+

---

## ğŸ“ å‘½åè§„èŒƒ

### Epoch é¡¹ç›®çº¦å®š

```swift
// âœ… SwiftData Model - å‰ç¼€ Cached
@Model class CachedTrainingLog { }
@Model class CachedTrainingPlan { }

// âœ… Firebase DTO - åç¼€ DTO
struct TrainingLogDTO: Codable { }
struct TrainingPlanDTO: Codable { }

// âœ… Mapper - åç¼€ Mapper
struct TrainingLogMapper { }

// âœ… Protocol - åç¼€ Protocol
protocol HealthKitServiceProtocol { }
protocol FirebaseServiceProtocol { }

// âœ… Mock - å‰ç¼€ Mock
class MockHealthKitService: HealthKitServiceProtocol { }

// âœ… Actor - åç¼€ Actorï¼ˆå¯é€‰ï¼‰
actor DataSyncActor { }
```

### åŸºæœ¬å‘½åè§„åˆ™

```swift
// âœ… ç±»å‹ - UpperCamelCase
class TrainingLogViewModel { }
struct UserProfile { }
enum GoalType { }

// âœ… å˜é‡å’Œå¸¸é‡ - lowerCamelCase
let userName = "John"
var isLoading = false
var trainingLogs: [TrainingLog] = []  // é›†åˆç”¨å¤æ•°

// âœ… å‡½æ•° - lowerCamelCase + åŠ¨è¯å¼€å¤´
func fetchTrainingLogs() async throws -> [TrainingLog]
func generatePlan(for user: User) async throws
func isValid() -> Bool  // å¸ƒå°”è¿”å›å€¼ç”¨ is/has å‰ç¼€

// âœ… å¸ƒå°”å€¼å‘½å
var isLoading = false
var hasCompletedOnboarding = true
var shouldShowAlert = false
var canEditPlan = true

// âœ… æ–‡ä»¶å‘½åï¼ˆä¸ç±»å‹åä¸€è‡´ï¼‰
TrainingLogView.swift
CachedTrainingLog.swift
TrainingLogDTO.swift
MockHealthKitService.swift
```

---

## ğŸ§µ å¹¶å‘ç¼–ç¨‹ï¼ˆSwift 6.2ï¼‰

### @MainActor ä½¿ç”¨è§„èŒƒ

**è§„åˆ™ï¼šæ‰€æœ‰ ViewModel å’Œ UI ä»£ç å¿…é¡»æ˜¾å¼æ ‡è®° @MainActor**

```swift
// âœ… æ­£ç¡® - ViewModel æ˜¾å¼æ ‡è®° @MainActor
@MainActor
@Observable
final class TrainingLogViewModel {
    var trainingLogs: [TrainingLog] = []
    var isLoading = false
    
    // è‡ªåŠ¨åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œ
    func fetchLogs() async {
        isLoading = true
        defer { isLoading = false }
        
        // åå°æ“ä½œè‡ªåŠ¨åœ¨éä¸»çº¿ç¨‹æ‰§è¡Œ
        let logs = try await healthKitService.fetchLogs()
        trainingLogs = logs  // å›åˆ°ä¸»çº¿ç¨‹æ›´æ–° UI
    }
}

// âœ… æ­£ç¡® - View è‡ªåŠ¨åœ¨ä¸»çº¿ç¨‹
struct TrainingLogView: View {
    @State private var viewModel: TrainingLogViewModel
    
    var body: some View {
        List(viewModel.trainingLogs) { log in
            TrainingLogRow(log: log)
        }
    }
}

// âŒ é”™è¯¯ - ViewModel æ²¡æœ‰ @MainActor
@Observable
final class TrainingLogViewModel {
    var trainingLogs: [TrainingLog] = []  // ç¼–è¯‘è­¦å‘Š
}
```

### Actor éš”ç¦»

```swift
// âœ… Service å±‚ä½¿ç”¨ Actor éš”ç¦»
actor HealthKitService: HealthKitServiceProtocol {
    private let healthStore = HKHealthStore()
    private var lastSyncDate: Date?
    private var cachedWorkoutIds: Set<String> = []
    
    func fetchWorkouts(limit: Int) async throws -> [TrainingLog] {
        // Actor è‡ªåŠ¨ä¿è¯çº¿ç¨‹å®‰å…¨
        let workouts = try await healthStore.fetchWorkouts()
        lastSyncDate = Date()
        return workouts.map { TrainingLogMapper.toSwiftData($0) }
    }
}

// ä½¿ç”¨æ—¶éœ€è¦ await
let service = HealthKitService()
let logs = await service.fetchWorkouts(limit: 20)
```

### Sendable åè®®

```swift
// âœ… å€¼ç±»å‹è‡ªåŠ¨ Sendable
struct TrainingLog: Sendable {
    let id: String
    let distance: Double
    let date: Date
}

// âœ… å¼•ç”¨ç±»å‹éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨
final class TrainingLogManager: @unchecked Sendable {
    private let queue = DispatchQueue(label: "com.epoch.logmanager")
    private var logs: [TrainingLog] = []
    
    func addLog(_ log: TrainingLog) {
        queue.async {
            self.logs.append(log)
        }
    }
}
```

---

## ğŸ¨ SwiftUI æœ€ä½³å®è·µ

### çŠ¶æ€ç®¡ç†

```swift
// âœ… iOS 17+ Observable å®
@MainActor
@Observable
final class TrainingLogViewModel {
    var trainingLogs: [TrainingLog] = []
    var isLoading = false
}

struct TrainingLogView: View {
    @State private var viewModel = TrainingLogViewModel()
    
    var body: some View {
        // è‡ªåŠ¨è§‚å¯Ÿ viewModel å˜åŒ–
        Text("\(viewModel.trainingLogs.count) logs")
    }
}

// âœ… ç®€å•å±€éƒ¨çŠ¶æ€ç”¨ @State
struct LoginView: View {
    @State private var email = ""
    @State private var password = ""
    @State private var isShowingAlert = false
}

// âœ… ç¯å¢ƒå€¼
struct TrainingLogView: View {
    @Environment(\.modelContext) private var modelContext
    @Environment(\.dismiss) private var dismiss
}
```

### View ç»„ç»‡

```swift
// âœ… æå–å¤æ‚å­è§†å›¾
struct TrainingLogCard: View {
    let log: TrainingLog
    
    var body: some View {
        VStack(alignment: .leading, spacing: 8) {
            headerView
            statsView
            notesView
        }
        .padding()
        .background(.thinMaterial)
        .cornerRadius(12)
    }
    
    private var headerView: some View {
        HStack {
            Text(log.formattedDate)
                .font(.headline)
            Spacer()
            Text("RPE \(log.rpe)")
                .font(.subheadline)
                .foregroundColor(.secondary)
        }
    }
    
    // ... æ›´å¤šå­è§†å›¾
}

// âŒ é¿å…ï¼šæ‰€æœ‰ä»£ç å†™åœ¨ä¸€ä¸ª body é‡Œï¼ˆéš¾ä»¥ç»´æŠ¤ï¼‰
```

### æ€§èƒ½ä¼˜åŒ–

```swift
// âœ… ä½¿ç”¨ LazyVStack å¤„ç†å¤§åˆ—è¡¨
ScrollView {
    LazyVStack(spacing: 12) {
        ForEach(viewModel.trainingLogs) { log in
            TrainingLogCard(log: log)
        }
    }
}

// âœ… æä¾›ç¨³å®šçš„ Identifiable
struct TrainingLog: Identifiable {
    let id: String  // ç¨³å®šä¸”å”¯ä¸€
    // ...
}
```

---

## ğŸ—ï¸ æ¶æ„æ¨¡å¼

### MVVM æ¨¡å¼

```swift
// âœ… ViewModel
@MainActor
@Observable
final class TrainingLogViewModel {
    // MARK: - Properties
    private let healthKit: HealthKitServiceProtocol
    private let firebaseService: FirebaseServiceProtocol
    private let modelContext: ModelContext
    
    var trainingLogs: [CachedTrainingLog] = []
    var isLoading = false
    var errorMessage: String?
    
    // MARK: - Initialization
    init(
        healthKit: HealthKitServiceProtocol = HealthKitService(),
        firebaseService: FirebaseServiceProtocol = FirebaseService(),
        modelContext: ModelContext
    ) {
        self.healthKit = healthKit
        self.firebaseService = firebaseService
        self.modelContext = modelContext
    }
    
    // MARK: - Public Methods
    func fetchRecentLogs() async {
        isLoading = true
        defer { isLoading = false }
        
        do {
            let logs = try await healthKit.fetchWorkouts(limit: 20)
            trainingLogs = logs
        } catch {
            errorMessage = error.localizedDescription
        }
    }
}

// âœ… Viewï¼ˆåªè´Ÿè´£ UIï¼‰
struct TrainingLogView: View {
    @State private var viewModel: TrainingLogViewModel
    
    var body: some View {
        NavigationStack {
            contentView
                .navigationTitle("è®­ç»ƒæ—¥å¿—")
        }
    }
    
    private var contentView: some View {
        ScrollView {
            LazyVStack(spacing: 12) {
                ForEach(viewModel.trainingLogs) { log in
                    TrainingLogCard(log: log)
                }
            }
            .padding()
        }
    }
}
```

### Protocol-Oriented Programming

```swift
// âœ… å®šä¹‰ Protocol
protocol HealthKitServiceProtocol {
    func fetchWorkouts(limit: Int) async throws -> [TrainingLog]
    func saveWorkout(_ workout: TrainingLog) async throws
}

// âœ… çœŸå®å®ç°
actor HealthKitService: HealthKitServiceProtocol {
    func fetchWorkouts(limit: Int) async throws -> [TrainingLog] {
        // çœŸå® HealthKit æŸ¥è¯¢
    }
}

// âœ… Mock å®ç°ï¼ˆæµ‹è¯•ç”¨ï¼‰
class MockHealthKitService: HealthKitServiceProtocol {
    var mockWorkouts: [TrainingLog] = []
    
    func fetchWorkouts(limit: Int) async throws -> [TrainingLog] {
        return mockWorkouts
    }
}

// âœ… ä¾èµ–æ³¨å…¥
@MainActor
@Observable
final class TrainingLogViewModel {
    private let healthKit: HealthKitServiceProtocol
    
    init(healthKit: HealthKitServiceProtocol = HealthKitService()) {
        self.healthKit = healthKit
    }
}
```

---

## ğŸŒ æœ¬åœ°åŒ–è§„èŒƒ

### ç±»å‹å®‰å…¨çš„æœ¬åœ°åŒ–

```swift
// âœ… æ­£ç¡® - ä½¿ç”¨ç±»å‹å®‰å…¨çš„ Key
Text(LocalizedString.Common.ok)
Button(LocalizedString.HealthKit.requestButton) { }

// âœ… æ­£ç¡® - å¸¦å‚æ•°çš„æœ¬åœ°åŒ–
Text(LocalizedString.HealthKit.workoutsList(count: 10))

// âŒ é”™è¯¯ - ç¡¬ç¼–ç æ–‡æœ¬
Text("ç¡®å®š")
Button("è¯·æ±‚æˆæƒ") { }

// âŒ é”™è¯¯ - ç›´æ¥ä½¿ç”¨ NSLocalizedString
Text(NSLocalizedString("common.ok", comment: ""))
```

**å®Œæ•´è§„èŒƒè§**: `docs/08-guidelines/coding-standards.md` ç¬¬ 15 ç« 

**ğŸ’¡ æç¤º**ï¼šç”¨æˆ·å¯è§çš„æ–‡æœ¬ï¼ˆUIã€æ—¥å¿—ã€é”™è¯¯æ¶ˆæ¯ï¼‰å°½é‡ä½¿ç”¨ `LocalizedString`ï¼Œé¿å…ç¡¬ç¼–ç ã€‚è¿™ä¸æ˜¯å¼ºåˆ¶è¦æ±‚ï¼Œä½†èƒ½æå‡ä»£ç è´¨é‡ã€‚

---

## ğŸ”’ å®‰å…¨ä¸é”™è¯¯å¤„ç†

### å¯é€‰å€¼å¤„ç†

```swift
// âœ… æ­£ç¡® - ä½¿ç”¨ if let / guard let
if let healthKitWorkoutId = log.healthKitWorkoutId {
    // ä½¿ç”¨ healthKitWorkoutId
}

guard let targetDate = goal.targetDate else {
    return  // æˆ–æŠ›å‡ºé”™è¯¯
}

// âœ… æ­£ç¡® - ä½¿ç”¨ nil-coalescing
let distance = log.distance ?? 0.0

// âŒ é”™è¯¯ - force unwrapï¼ˆé™¤éç»å¯¹å®‰å…¨ï¼‰
let distance = log.distance!
```

### é”™è¯¯å¤„ç†

```swift
// âœ… æ­£ç¡® - ä½¿ç”¨ throws å’Œ do-catch
enum HealthKitError: Error, LocalizedError {
    case notAvailable
    case authorizationDenied
    
    var errorDescription: String? {
        switch self {
        case .notAvailable:
            return LocalizedString.Errors.healthKitNotAvailable
        case .authorizationDenied:
            return LocalizedString.Errors.healthKitAuthDenied
        }
    }
}

func fetchWorkouts() async throws -> [TrainingLog] {
    guard HKHealthStore.isHealthDataAvailable() else {
        throw HealthKitError.notAvailable
    }
    // ...
}

// ä½¿ç”¨æ—¶
do {
    let workouts = try await fetchWorkouts()
} catch {
    print("Error: \(error.localizedDescription)")
}

// âŒ é”™è¯¯ - ç®€å• try!ï¼ˆä¼šå´©æºƒï¼‰
let workouts = try! fetchWorkouts()
```

---

## ğŸ“‹ ä»£ç å®¡æŸ¥æ¸…å•

### æäº¤å‰è‡ªæŸ¥

**ä»£ç è´¨é‡**ï¼š
- [ ] æ‰€æœ‰å‡½æ•°èŒè´£å•ä¸€
- [ ] æ²¡æœ‰ç¡¬ç¼–ç çš„é­”æ³•æ•°å­—
- [ ] åˆ é™¤äº†æ‰€æœ‰ `print` è°ƒè¯•ä»£ç 
- [ ] æ²¡æœ‰æ³¨é‡Šæ‰çš„ä»£ç 

**å‘½åè§„èŒƒ**ï¼š
- [ ] ç±»å‹éµå¾ª UpperCamelCase
- [ ] å˜é‡éµå¾ª lowerCamelCase
- [ ] å¸ƒå°”å€¼ä½¿ç”¨ is/has/should å‰ç¼€
- [ ] SwiftData Model ä½¿ç”¨ `Cached` å‰ç¼€
- [ ] Firebase DTO ä½¿ç”¨ `DTO` åç¼€

**å¹¶å‘ç¼–ç¨‹**ï¼š
- [ ] ViewModel æ ‡è®°äº† `@MainActor`
- [ ] Service å±‚ä½¿ç”¨ Actor éš”ç¦»ï¼ˆå¦‚æœæœ‰å…±äº«çŠ¶æ€ï¼‰
- [ ] æ²¡æœ‰æ•°æ®ç«äº‰é£é™©
- [ ] å¼‚æ­¥æ“ä½œä½¿ç”¨ async/await

**iOS ç‰ˆæœ¬**ï¼š
- [ ] iOS 26 ç‰¹æ€§æœ‰é™çº§æ–¹æ¡ˆ
- [ ] ä½¿ç”¨ `#available` å¤„ç†ç‰ˆæœ¬å·®å¼‚
- [ ] åœ¨ iOS 18 çœŸæœºæµ‹è¯•è¿‡

**æµ‹è¯•**ï¼š
- [ ] æ ¸å¿ƒé€»è¾‘æœ‰å•å…ƒæµ‹è¯•
- [ ] æµ‹è¯•è¦†ç›–ç‡ â‰¥ 70%
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡

---

## ğŸ”— å‚è€ƒèµ„æº

### é¡¹ç›®æ–‡æ¡£
- **å®Œæ•´ç¼–ç è§„èŒƒ**: `docs/08-guidelines/coding-standards.md`ï¼ˆ2000+ è¡Œï¼‰
- **SwiftData Schema**: `docs/04-implementation/swiftdata-schema.md`
- **HealthKit é›†æˆ**: `docs/04-implementation/healthkit-integration.md`

### Apple å®˜æ–¹æ–‡æ¡£
- **Swift API Design Guidelines**: https://www.swift.org/documentation/api-design-guidelines/
- **SwiftUI Documentation**: https://developer.apple.com/documentation/swiftui
- **SwiftData Guide**: https://developer.apple.com/documentation/swiftdata
- **HealthKit Documentation**: https://developer.apple.com/documentation/healthkit

---

**æœ€åæ›´æ–°**: 2025-11-03  
**ç‰ˆæœ¬**: 1.0  
**åŸºäº**: Swift 6.2, iOS 26 (å…¼å®¹ iOS 18)

