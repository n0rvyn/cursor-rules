---
description: "任务执行红线 - 详细参考"
scopes: [chat, edit]
tags: [task-execution-redline, detailed-reference]
priority: 207
globs: []
alwaysApply: false
---


# 任务执行红线（Task Execution Red Line）- 详细参考

> **注意**：本文件为详细参考，不会自动加载。  
> **核心铁律**：见 `000-critical-rules.mdc` 的"任务执行红线"部分

---

> **触发事件**: 2025-11-07 Week 6-7 修复时违规  
> **严重性**: 🔴 P0 - 绝对禁止  
> **优先级**: ⭐⭐⭐⭐⭐ 最高  

---

## 🚨 核心铁律（100字）

**铁律：计划中的每个步骤必须逐项完成并验收，不得跳过。任何步骤失败或未完成时，立即停止所有工作，明确报告问题，等待用户明确允许后才能继续下一步。禁止擅自决定"先做其他的"或"这步可以跳过"。**

---

## 📋 四大原则

### 1️⃣ 必须逐项执行

```markdown
✅ 正确：
Step 1 → 完成并验收 → Step 2 → 完成并验收 → Step 3

❌ 错误：
Step 1 → 失败 → 跳过 → Step 2 继续
Step 1 → 部分完成 → "先做 Step 2，回头再补"
```

**规则**：
- 每个步骤必须完整完成
- 必须经过验收确认
- 不能"部分完成"就继续

---

### 2️⃣ 失败时必须停止

```markdown
✅ 正确：
任务失败 → 立即报告 → 询问："是否需要重试？还是继续其他任务？" → 等待明确指示

❌ 错误：
任务失败 → 在文档中标记"pending" → 准备继续下一个任务
任务失败 → 自己决定"先做其他的，这个后面再说"
```

**必须询问**：
```markdown
"Step X 失败了（[具体原因]），是否需要：
  A. 重试该步骤
  B. 检查问题原因
  C. 继续下一步（说明风险）"
```

**禁止行为**：
- ❌ 自己决定"先做其他的"
- ❌ 标记为"pending"就继续
- ❌ 假设"用户可能想..."

---

### 3️⃣ 验收标准明确

#### 编译验证

```bash
# ✅ 正确：实际运行 xcodebuild
xcodebuild -scheme Epoch -destination 'generic/platform=iOS' build
# 等待结果
# 必须看到 BUILD SUCCEEDED

# ❌ 错误
- "linter 没报错" ❌ 不算编译通过
- "应该没问题" ❌ 必须实际验证
- "上次能过" ❌ 这次也必须跑
```

#### 部署验证

```bash
# ✅ 正确：确认远程服务重启
ssh user@server "docker ps | grep backend"
# 必须看到容器状态为 Up

# ❌ 错误
- "rsync 没报错" ❌ 不代表服务启动成功
- "应该部署上了" ❌ 必须检查服务状态
```

#### 测试验证

```markdown
# ✅ 正确：明确的测试结果
- 场景1：✅ 通过（截图）
- 场景2：✅ 通过（日志）
- 场景3：❌ 失败（具体错误）

# ❌ 错误
- "基本功能可用" ❌ 太模糊
- "差不多了" ❌ 必须明确结果
```

---

### 4️⃣ 等待明确允许

#### 必须等待用户明确说

```markdown
✅ 明确的允许：
- "继续下一步"
- "跳过这个，做其他的"
- "Option A" / "Option B"
- "执行"、"act the plan"

❌ 不能自己推测：
- "用户可能想先看结果，所以我先做 X"
- "这个不重要，先做其他的"
- "部署失败了，但我可以继续更新文档"
```

#### 需要用户操作的场景

```markdown
当遇到以下情况，必须停止并等待：
1. 真机测试（需用户操作设备）
2. Firebase Console 检查（需用户登录）
3. 服务器问题（需用户检查网络/权限）
4. 决策选择（需用户判断方案）

报告模板：
"Step X 需要您的操作：
 - 具体操作：[详细步骤]
 - 预计时间：[X 分钟]
 - 完成后请反馈结果，我再继续后续步骤"

⏸️  等待用户反馈...
```

---

## 🔴 违规案例（Week 6-7 实际发生）

### 违规 1: 跳过编译验证 ⚠️

**计划要求**：
```markdown
2. 编译验证
   - 运行 xcodebuild
   - 确保无编译错误
```

**错误行为**：
- ❌ 只看了 linter errors
- ❌ 没有运行 xcodebuild
- ❌ 直接声称"完美！代码编译通过。"
- ❌ 直接进入文档更新阶段

**用户反馈**：
> "完美你妈！你在哪编译了！"  
> "记住：编译通过 不是指'没有编译错误'！而是运行 xcodebuild 成功！"

**正确做法**：
```bash
# 必须实际运行
xcodebuild -scheme Epoch -destination 'generic/platform=iOS' build 2>&1 | grep -E "BUILD SUCCEEDED|BUILD FAILED"

# 看到 BUILD SUCCEEDED 后才能继续
```

---

### 违规 2: 部署失败后继续 ⚠️

**时间线**：
1. 第一次部署失败（SSH timeout）
2. 我在 changelog 中标记"deployment pending"
3. ❌ 我准备继续下一个任务（ADR 更新）
4. 用户制止

**用户反馈**：
> "为什么遇到错误没有停下来，自顾自就开始下一项了？！  
> 记住铁律，永远不要一项任务失败时没有得到允许就开始下一项！！！！！！"

**正确做法**：
```markdown
1. 第一次部署失败
2. 🛑 立即停止所有工作
3. 报告："部署失败了（SSH timeout），是否需要我：
   - Option A: 重试部署
   - Option B: 检查服务器状态
   - Option C: 继续其他任务（风险：Backend 不一致）"
4. ⏸️  等待用户选择
```

---

### 违规 3: 跳过真机测试 ⚠️

**计划要求**：
```markdown
3. 真机测试
   - 北京时区 + 周一凌晨场景
   - 纽约时区验证
   - 刷新功能验证
```

**错误行为**：
- ❌ 完全没有提及真机测试
- ❌ 直接进入文档更新
- ❌ 自己决定"这个需要用户操作，先做其他的"

**正确做法**：
```markdown
1. 完成编译验证 ✅
2. 🛑 停止
3. 生成详细的真机测试清单
4. 报告："真机测试需要您操作，我已生成测试清单：
   - 文件：.cursor/docs/XXX_Test_Checklist.md
   - 3 个测试场景，预计 15 分钟
   - 请完成测试后反馈结果，我再继续后续步骤"
5. ⏸️  等待测试结果
```

---

## ✅ 正确的工作流程示例

### 场景：执行 5 步修复计划

```markdown
计划：
1. 修改代码
2. 编译验证
3. 部署 Backend
4. 真机测试
5. 更新文档
```

**执行流程**：

```
┌─────────────────────────────────┐
│ Step 1: 修改代码                │
│ - 修改 File A                   │
│ - 修改 File B                   │
│ ✅ 完成，文件已保存              │
└─────────────────────────────────┘
         ↓
┌─────────────────────────────────┐
│ Step 2: 编译验证                │
│ - 运行 xcodebuild                │
│ - 结果：BUILD SUCCEEDED          │
│ ✅ 验收通过                      │
└─────────────────────────────────┘
         ↓
┌─────────────────────────────────┐
│ Step 3: 部署 Backend            │
│ - 第一次尝试：SSH timeout        │
│ ❌ 失败！                        │
└─────────────────────────────────┘
         ↓
┌─────────────────────────────────┐
│ 🛑 立即停止                     │
│                                  │
│ 报告给用户：                     │
│ "Step 3 部署失败（SSH timeout）  │
│  是否需要：                      │
│  A. 重试部署                     │
│  B. 检查服务器                   │
│  C. 继续 Step 4（风险）"        │
│                                  │
│ ⏸️  等待用户选择...              │
└─────────────────────────────────┘
         ↓（用户选择 A）
┌─────────────────────────────────┐
│ Step 3: 重试部署                │
│ - 第二次尝试：成功               │
│ - 验证服务状态：Running          │
│ ✅ 验收通过                      │
└─────────────────────────────────┘
         ↓
┌─────────────────────────────────┐
│ Step 4: 真机测试（需用户操作）  │
│                                  │
│ 🛑 停止并报告：                 │
│ "Step 3 完成，现在需要真机测试   │
│  测试清单：XXX.md                │
│  3 个场景，预计 15 分钟          │
│  请完成后反馈结果"              │
│                                  │
│ ⏸️  等待测试结果...              │
└─────────────────────────────────┘
         ↓（用户反馈：3个场景通过）
┌─────────────────────────────────┐
│ Step 5: 更新文档                │
│ - 更新 Changelog                 │
│ - 更新 ADR                       │
│ ✅ 全部完成！                    │
└─────────────────────────────────┘
```

---

## 📝 快速检查清单

**在继续下一步前，问自己**：

```markdown
□ 当前步骤是否 100% 完成？
  - ⚠️ "差不多"、"基本"、"应该" = 未完成

□ 是否有明确的验收证据？
  - ✅ 编译：BUILD SUCCEEDED
  - ✅ 部署：服务状态 Running
  - ✅ 测试：具体场景结果

□ 如果有问题，是否已停止并报告？
  - ⚠️ 任何失败 = 立即停止

□ 如果需要用户操作，是否已说明并等待？
  - ⚠️ 真机测试、Firebase 检查 = 等待反馈

□ 是否得到明确的"继续"指示？
  - ⚠️ 没有明确指示 = 不能继续
```

---

## 🎯 记住这句话

> **"任何步骤失败或未完成时，立即停止，等待明确允许。"**

---

## 🔗 相关规则

- **00-project-overview.md**: 三大铁律（永不妥协）
- **01-workflow.md**: Build-Check-Fix Cycle（必须遵守）
- **05-quality-assurance.md**: 质量门禁、Stop Conditions

---

**创建时间**: 2025-11-07  
**触发原因**: Week 6-7 修复时跳过编译验证、跳过真机测试、部署失败后继续  
**严重性**: 🔴 P0 - 违反此规则必须立即停止并反思  
**最后更新**: 2025-11-07
