---
description: "æµ‹è¯•ç­–ç•¥ä¸è¦†ç›–ç‡ - æ£€æŸ¥æ¸…å•"
scopes: [chat, edit]
tags: [testing, unit-tests, mocking, checklist]
priority: 104
globs: ["**/*Test*.swift", "**/*Tests.swift"]
alwaysApply: false
---

# æµ‹è¯•æ£€æŸ¥æ¸…å•

> **è§¦å‘æ¡ä»¶**: ç¼–è¾‘æµ‹è¯•æ–‡ä»¶æ—¶è‡ªåŠ¨åŠ è½½  
> **è¯¦ç»†å‚è€ƒ**: `docs/09-roadmap/testing-strategy.md`

---

## ğŸ”´ æ ¸å¿ƒçº¦æŸ

### æµ‹è¯•è¦†ç›–ç‡è¦æ±‚ â­â­â­â­â­

| æ¨¡å— | æœ€ä½è¦†ç›–ç‡ | è¯´æ˜ |
|---|-----|---|
| æ•°æ®å±‚æ ¸å¿ƒ (SwiftData CRUD, Mapper) | 100% | ğŸ”´ å¿…é¡» |
| æ•°æ®å±‚æ•´ä½“ | â‰¥80% | ğŸŸ¡ æ¨è |
| ä¸šåŠ¡é€»è¾‘ (è®¡ç®—ã€éªŒè¯) | â‰¥75% | ğŸ”´ å¿…é¡» |
| ViewModel | â‰¥70% | ğŸŸ¡ æ¨è |
| View (UI) | â‰¥30% | ğŸŸ¢ å¯é€‰ |

### Protocol-based Mockï¼ˆå¼ºåˆ¶ï¼‰

```swift
// âœ… æ­£ç¡®ï¼šå…ˆå®šä¹‰ Protocol
protocol HealthKitServiceProtocol {
    func fetchWorkouts() async throws -> [TrainingLog]
}

// ç”Ÿäº§å®ç°
actor HealthKitService: HealthKitServiceProtocol { }

// æµ‹è¯•å®ç°
class MockHealthKitService: HealthKitServiceProtocol {
    var mockWorkouts: [TrainingLog] = []
    
    func fetchWorkouts() async throws -> [TrainingLog] {
        return mockWorkouts
    }
}

// âŒ é”™è¯¯ï¼šMock å‰ç¼€ç”¨äºæµ‹è¯•ï¼Œä¸èƒ½åœ¨ç”Ÿäº§ä»£ç ä¸­ä½¿ç”¨
```

---

## ğŸ“‹ æ“ä½œæ­¥éª¤æ¨¡æ¿

### åˆ›å»ºå•å…ƒæµ‹è¯•

```swift
import XCTest
@testable import Epoch

final class TrainingLogViewModelTests: XCTestCase {
    var viewModel: TrainingLogViewModel!
    var mockHealthKit: MockHealthKitService!
    var mockModelContext: ModelContext!
    
    override func setUp() async throws {
        mockHealthKit = MockHealthKitService()
        mockModelContext = try ModelContext(...)
        viewModel = TrainingLogViewModel(
            healthKit: mockHealthKit,
            modelContext: mockModelContext
        )
    }
    
    func testFetchRecentLogs() async throws {
        // Given
        mockHealthKit.mockWorkouts = [
            createMockWorkout(distance: 5000, duration: 1800)
        ]
        
        // When
        try await viewModel.fetchRecentLogs()
        
        // Then
        XCTAssertEqual(viewModel.trainingLogs.count, 1)
        XCTAssertEqual(viewModel.trainingLogs[0].distance, 5000)
    }
}
```

---

## ğŸ”— è¯¦ç»†å‚è€ƒ

| æ–‡æ¡£ | å†…å®¹ |
|------|------|
| `docs/09-roadmap/testing-strategy.md` | â­ å®Œæ•´æµ‹è¯•ç­–ç•¥ï¼ˆå¿…è¯»ï¼‰ |

---

**æœ€åæ›´æ–°**: 2025-11-08  
**Token ä¼°ç®—**: ~600 tokens  
**åŠ è½½æ–¹å¼**: Auto-attachï¼ˆglobs åŒ¹é…æ—¶ï¼‰  
**ä¼˜å…ˆçº§**: 104

